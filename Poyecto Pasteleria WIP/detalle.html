<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PastelerÃ­a Umai | Detalle</title>
  
  <link rel="stylesheet" href="Css/home.css">
  <link rel="stylesheet" href="css/stylescarrito.css">
  
  <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>

  <nav class="navbar">
    <div class="logo">Pasteleria Â¡Umai!</div>
    <ul class="nav-links">
      <li><a href="index.html">Inicio</a></li>
      <li><a href="catalogo.html" style="color: #5d4037; background: skyblue;">Catalogo</a></li>
      <li><a href="servicios.html">Servicios</a></li>
      <li><a href="proyectos.html">Proyectos</a></li>
      <li><a href="contacto.html">Contacto</a></li>
      <li><a href="carrito.html">ğŸ›’ <span id="cart-count">0</span></a></li>
    </ul>
    <div class="btnLogin">
      <button onclick="window.location.href='LoginUsuario.html'">Iniciar Sesion</button>
    </div>
  </nav>

  <main class="detalle-main-container">
    
    <div id="loading-msg" style="text-align: center;">Cargando producto...</div>

    <div id="detalle-content" class="detalle-card" style="display: none;">
      
      <img id="detalle-img" src="" alt="Producto">

      <div class="detalle-info">
        <span id="detalle-categoria" class="detalle-categoria">CategorÃ­a</span>
        <h2 id="detalle-nombre">Nombre del Producto</h2>
        
        <p id="detalle-descripcion" class="detalle-descripcion">DescripciÃ³n corta...</p>
        
        <div style="background: #fff8f0; padding: 10px; border-radius: 10px; border-left: 4px solid #e85a9d;">
            <strong>Historia:</strong>
            <p id="detalle-historia" class="detalle-historia" style="font-size: 0.9rem; margin:0;"></p>
        </div>

        <p id="detalle-precio" class="detalle-precio">$0</p>

        <div class="mensaje-box">
          <label for="mensaje">Â¿Quieres agregar un mensaje en la torta?</label>
          <textarea id="mensaje" placeholder="Ej: Feliz CumpleaÃ±os MamÃ¡ (Opcional)"></textarea>
        </div>

        <div class="acciones-detalle">
          <a href="catalogo.html" class="btn-volver">â† Volver</a>
          <button id="btn-add-cart" class="btn-agregar-grande">AÃ±adir al Carrito ğŸ›’</button>
        </div>
      </div>

    </div>
  </main>

  <script src="js/data.js"></script>
  <script src="js/carrito.js"></script>

  <script>
    // LÃ³gica EspecÃ­fica para cargar el detalle
    document.addEventListener("DOMContentLoaded", () => {
        // 1. Obtener ID de la URL
        const params = new URLSearchParams(window.location.search);
        const idProducto = params.get("id");

        // 2. Buscar producto en data.js
        const producto = productos.find(p => p.id === idProducto);
        
        const loading = document.getElementById("loading-msg");
        const contenido = document.getElementById("detalle-content");

        if (producto) {
            loading.style.display = "none";
            contenido.style.display = "flex"; // Mostrar tarjeta

            // 3. Rellenar datos
            document.getElementById("detalle-img").src = producto.imagen;
            document.getElementById("detalle-nombre").textContent = producto.nombre;
            document.getElementById("detalle-categoria").textContent = producto.categoria;
            document.getElementById("detalle-descripcion").textContent = producto.descripcion;
            document.getElementById("detalle-historia").textContent = 
                producto.historia || "Una deliciosa receta artesanal hecha con los mejores ingredientes.";
            document.getElementById("detalle-precio").textContent = 
                "$" + producto.precio.toLocaleString("es-CL");

            // 4. Configurar botÃ³n AÃ±adir
            document.getElementById("btn-add-cart").onclick = () => {
                const mensaje = document.getElementById("mensaje").value.trim();
                
                // Creamos un objeto copia para no modificar el original
                // y le agregamos el mensaje si existe
                const productoParaCarrito = { ...producto };
                if(mensaje) {
                    productoParaCarrito.mensaje = mensaje;
                    productoParaCarrito.nombre = producto.nombre + " (Dedicatoria: " + mensaje + ")";
                }

                agregarAlCarrito(productoParaCarrito);
                
                // Feedback visual
                const btn = document.getElementById("btn-add-cart");
                const textoOriginal = btn.textContent;
                btn.textContent = "Â¡Agregado!";
                btn.style.backgroundColor = "#98fb98"; // Verde claro
                setTimeout(() => {
                    btn.textContent = textoOriginal;
                    btn.style.backgroundColor = ""; 
                }, 1500);
            };

        } else {
            loading.innerHTML = "<h3>Producto no encontrado ğŸ˜•</h3><br><a href='catalogo.html' class='btn-volver'>Volver al catÃ¡logo</a>";
        }

        // Actualizar contador del carrito en navbar
        actualizarContador();
    });
  </script>

</body>
</html>